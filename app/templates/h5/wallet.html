<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Wallet Realtime Test</title>
</head>

<body>
  <h2>ğŸ”¥ é’±åŒ…å®æ—¶ç›‘å¬æµ‹è¯•</h2>

  <div>ä½™é¢ï¼š<span id="balance">loading...</span> å…ƒ</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
    import { getAuth, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";

    // âœ… Firebaseé…ç½®ï¼ˆå›ºå®šå°±è¡Œï¼‰
    const firebaseConfig = {
      apiKey: "AIzaSyDFdByzZ3hR-pkh6TR1nCJ04tVko41Z_E8",
      authDomain: "ttte-a5dae.firebaseapp.com",
      projectId: "ttte-a5dae",
      storageBucket: "ttte-a5dae.appspot.com",
      messagingSenderId: "379230954149",
      databaseURL: "https://ttte-a5dae-default-rtdb.asia-southeast1.firebasedatabase.app",
      appId: "1:379230954149:web:19a9f93f1b881d170ba34c"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // âœ… æ¨¡æ‹Ÿä»åç«¯æ‹¿ Tokenï¼ˆæ­£å¼åº” fetch åç«¯æ¥å£ï¼‰
    const firebaseToken = prompt("è¯·è¾“å…¥åç«¯å‘çš„ Firebase Tokenï¼š");

    // âœ… ç™»å½•
    signInWithCustomToken(auth, firebaseToken).then(() => {
      console.log("âœ… Firebase ç™»å½•æˆåŠŸ", auth.currentUser.uid);

      const uid = auth.currentUser.uid;
      const walletRef = ref(db, `user_wallet/${uid}/balance`);

      // âœ… å®æ—¶ç›‘å¬é’±åŒ…ä½™é¢
      onValue(walletRef, (snapshot) => {
        const balance = snapshot.val();
        console.log("ğŸ“¡ ä½™é¢æ›´æ–°ï¼š", balance);
        document.getElementById("balance").innerText = balance ?? 0;
      });

    }).catch((err) => {
      console.error("âŒ Firebase ç™»å½•å¤±è´¥ï¼š", err);
      alert("Token æ— æ•ˆï¼Œè¯·æ£€æŸ¥åå° issuedToken()");
    });
  </script>
</body>
</html>
